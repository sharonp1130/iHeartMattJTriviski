package help.me.orm.entity;
// Generated Nov 26, 2015 6:04:16 PM by Hibernate Tools 4.3.1.Final

import java.util.Collection;
import java.util.Date;
import java.util.HashSet;
import java.util.Iterator;
import java.util.Set;

import javax.persistence.CascadeType;
import javax.persistence.Column;
import javax.persistence.Entity;
import javax.persistence.EntityListeners;
import javax.persistence.FetchType;
import javax.persistence.GeneratedValue;
import javax.persistence.Id;
import javax.persistence.JoinColumn;
import javax.persistence.OneToMany;
import javax.persistence.OneToOne;
import javax.persistence.Table;
import javax.persistence.Temporal;
import javax.persistence.TemporalType;
import javax.persistence.Transient;
import javax.persistence.UniqueConstraint;

import org.apache.commons.validator.EmailValidator;
import org.hibernate.annotations.Cascade;
import org.hibernate.annotations.Generated;
import org.hibernate.annotations.GenerationTime;
import org.hibernate.annotations.GenericGenerator;

import help.me.orm.listener.LastUpdateListener;

/**
 * User generated by hbm2java
 */
/**
 * @author triviski
 *
 */
@SuppressWarnings("serial")
@Entity
@Table(name = "user", uniqueConstraints = @UniqueConstraint(columnNames = "email") )
@EntityListeners( value={LastUpdateListener.class})
public class User implements java.io.Serializable {
	
	private int userId;
	private Info info;
	private Settings settings;
	private String email;
	private String firstName;
	private String lastName;
	boolean isProvider;
    private Set<License> licenses = new HashSet<License>(0);

	private Date createdAt;
	private Date updatedAt;

	// I took this out, no reason to load them all in this entity.
    // private Set<Location> locations = new HashSet<Location>(0);

	/**
	 * 
	 */
	public User() {
	}


    public User(int userId, Info info, Settings settings, String email, String firstName, String lastName,
			boolean isProvider, Set<License> licenses, Date createdAt, Date updatedAt) {
		super();
		this.userId = userId;
		this.info = info;
		this.settings = settings;
		this.firstName = firstName;
		this.lastName = lastName;
		this.isProvider = isProvider;
		this.licenses = licenses;
		this.createdAt = createdAt;
		this.updatedAt = updatedAt;
		
		this.setEmail(email);
	}


	@Id
	@GeneratedValue(generator="userIncrement")
	@GenericGenerator(name="userIncrement", strategy = "increment")
	@Column(name = "userId", unique = true, nullable = false)
	public int getUserId() {
		return this.userId;
	}

	public void setUserId(int userId) {
		this.userId = userId;
	}

	@Column(name = "isProvider", nullable = false, columnDefinition = "TINYINT(1)")
	public boolean getIsProvider() {
		return isProvider;
	}

	public void setIsProvider(boolean isProvider) {
		this.isProvider = isProvider;
	}

	@OneToOne(fetch=FetchType.LAZY, cascade=CascadeType.ALL, mappedBy="user")
	@Cascade(org.hibernate.annotations.CascadeType.SAVE_UPDATE)
	public Info getInfo() {
		return this.info;
	}

	public void setInfo(Info info) {
		this.info = info;
	}

	@JoinColumn(name = "settings", nullable=true)
	@OneToOne(fetch=FetchType.LAZY, cascade=CascadeType.ALL)
	public Settings getSettings() {
		return this.settings;
	}

	public void setSettings(Settings settings) {
		this.settings = settings;
	}
	
	@Column(name = "firstName", unique = false, nullable = false, length = 20)
	public String getFirstName() {
		return this.firstName;
	}
	
	public void setFirstName(String firstName) {
		this.firstName = firstName;
	}

	@Column(name = "lastName", unique = false, nullable = false, length = 20)
	public String getLastName() {
		return this.firstName;
	}
	
	public void setLastName(String lastName) {
		this.lastName = lastName;
	}
	
	@Column(name = "email", unique = true, nullable = false, length = 50)
	public String getEmail() {
		return this.email;
	}

	/**
	 * @param email
	 */
	public void setEmail(String email) {
		if (!EmailValidator.getInstance().isValid(email)) {
			throw new IllegalStateException("Email address is invalid.");
		}
		
		this.email = email;
	}

	/**
	 * @param license Add a new license.
	 */
	@Transient
	public void addLicense(License license) {
		this.licenses.add(license);
	}
	
    @Cascade(org.hibernate.annotations.CascadeType.SAVE_UPDATE)
    @OneToMany(fetch=FetchType.EAGER, mappedBy="user", cascade=CascadeType.ALL)
    public Set<License> getLicenses() {
        return this.licenses;
    }
    
    public void setLicenses(Set<License> licenses) {
        this.licenses = licenses;
    }
	
	@Generated(GenerationTime.INSERT) 
	@Temporal(TemporalType.TIMESTAMP)
	@Column(name = "created_at", length = 19, insertable=false, updatable=false)
	public Date getCreatedAt() {
		return this.createdAt;
	}

	public void setCreatedAt(Date createdAt) {
		this.createdAt = createdAt;
	}

	@Generated(GenerationTime.ALWAYS) 
	@Temporal(TemporalType.TIMESTAMP)
	@Column(name = "updated_at", length = 19, insertable=false, updatable=true)
	public Date getUpdatedAt() {
		return this.updatedAt;
	}

	public void setUpdatedAt(Date updatedAt) {
		this.updatedAt = updatedAt;
	}
	
	@Override
	public String toString() {
		final int maxLen = 10;
		StringBuilder builder = new StringBuilder();
		builder.append("User [userId=");
		builder.append(userId);
		builder.append(", info=");
		builder.append(info);
		builder.append(", settings=");
		builder.append(settings);
		builder.append(", email=");
		builder.append(email);
		builder.append(", firstName=");
		builder.append(firstName);
		builder.append(", lastName=");
		builder.append(lastName);
		builder.append(", isProvider=");
		builder.append(isProvider);
		builder.append(", licenses=");
		builder.append(licenses != null ? toString(licenses, maxLen) : null);
		builder.append(", createdAt=");
		builder.append(createdAt);
		builder.append(", updatedAt=");
		builder.append(updatedAt);
		builder.append("]");
		return builder.toString();
	}

	private String toString(Collection<?> collection, int maxLen) {
		StringBuilder builder = new StringBuilder();
		builder.append("[");
		int i = 0;
		for (Iterator<?> iterator = collection.iterator(); iterator.hasNext() && i < maxLen; i++) {
			if (i > 0)
				builder.append(", ");
			builder.append(iterator.next());
		}
		builder.append("]");
		return builder.toString();
	}

}
